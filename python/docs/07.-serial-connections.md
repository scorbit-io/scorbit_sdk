# Serial Connection

A game can also send current score information over a serial connection to a Scorbitron. The Scorbitron is a USB host, and expects a 115200 connection into port 3 of the USB C ports. A null USB, such as the FTDI USB NMC-2.5m, has been tested for a USB to USB solution.

The Scorbitron appears as `/dev/ttyUSBx` (e.g., `ttyUSB0`) on Linux systems.  Because it uses an FTDI null modem cable, it will appear as USB Vendor ID 0x0403 and Product ID 0x6001.

On a Linux system, you can use the following udev rule to have it map to `/dev/scorbitron` (perhaps as `/etc/udev/rules.d/09-scorbitron.rules`):
```
SUBSYSTEM=="tty", ATTRS{idVendor}=="0403", ATTRS{idProduct}=="6001", SYMLINK+="scorbitron"
```

The Scorbitron Mini (upcoming serial-only product) is a USB device that appears as `/dev/ttyACMx` (e.g., `ttyACM0`) on Linux systems.  It's possible to identify it by its unique USB Vendor ID (0x10c4) and Product ID (0x8d44).  

On a Linux system, you can use the following udev rule to have it map to `/dev/scorbitron-mini` (perhaps as `/etc/udev/rules.d/09-scorbitron-mini.rules`):
```
SUBSYSTEM=="tty", ATTRS{idVendor}=="10c4", ATTRS{idProduct}=="8d44", SYMLINK+="scorbitron-mini"
```

This is a typical initialization line for most Linux controllers:

`stty -F /dev/ttyUSB0 115200 cs8 -cstopb -parenb`

## Flow Control

Upon receiving a stand-alone new line command, the game should stop sending any data wait for a command from the Scorbitron.

## Version Information

When the game starts the first time and establishes a serial connection to the Scorbitron, the Scorbitron will send the string:

`zc ver`

The game should respond with any game code version information and the manufacturer name in brackets, then wait for another command:

`[v1.4.1,Spooky]`

or

`[v1.0.1,American]`

## Serial Number

The Scorbitron will always send the command with an attempt to get a serial number:

`zc serial`

The game should respond with the serial number in brackets and begin sending game data again:

`[123456789]`

## Format for Game Data

The game should send game data on a repeating frequency using the following syntax:

`s,p1score,p2score,p3score,p4score,currentplayer,currentball,[game_mode;game_mode]n\n`

Where:

* s:             character representing start of package
* p1score:       [-1] means no player set at this time
                 [0] means new player added (if no session we start one)
                 [number] means a actual score update
* p2score:       same as above
* p3score:       same as above
* p4score:       same as above
* currentplayer: [-1] game is over
                 [number] means current player number
* currentball:   [-1] game is over
                 [number] means current ball number
* [game_mode]:   any number of game modes separated by semi-colons. (see Game Modes section for syntax.)
* n:             character representing end of package
* \n:            end of line

So for example,

`s,45667,7654,567,-1,1,3,n\n`

would mean:

* Player 1: 45667
* Player 2: 7654
* Player 3: 567
* Player 4: Doesn't exist
* Current player: Player 1
* Current ball: 3

or

`s,0,0,-1,-1,1,1,n\n`

This represents the start of a two player game. If an API session to Scorbit is not open, we open one and expect two players. Duplicates are de-duped and accepted.

`s,0,-1,-1,-1,1,1,n\n`<br>
`s,0,-1,-1,-1,1,1,n\n`<br>
`s,0,0,-1,-1,1,1,n\n`

In this example, the game starts with one player, and a moment later a second player is added.

## Game Modes

Please see related section on [Providing game modes using serial connection](../08.-Game-Modes#providing-game-modes-using-serial-connection).

## Frequency

The machine can send Scorbit updates as fast as the score or game state changes, including multiple times in a second. Therefore, you can tie the update to a state changes if the architecture allows it, or on a frequency. However, if there are no updates, Scorbit recommends sending duplicate updates at least one per second. If we do not get an update in three seconds, the Scorbitron record sthat as a timeout error and may cause issues or resets. In addition, some serial controllers can sleep when not kept alive, depending on the hardware, so best to keep the updates at least once per second.