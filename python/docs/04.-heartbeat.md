# Heartbeat

The purpose of the heartbeat is to contact the API on an interval to indicate that the game is alive. It also has the added benefit of communicating the status of the game session, and providing configuration information to the API.

Overall, the intent is for the heartbeat to run both during idle times within games and during idle time between actual games. We recommend anywhere from 5 to 10 second intervals. As a reference, the Scorbitron hardware currently sends heartbeats every 10 seconds.

This heartbeat not only can inform the local machine of successful connectivity with an API response, but also alerts the operator via the Scorbit app (or other application) of the machine going offline, as well as a game session ending.

Make sure to get an auth token and use it in the header as `Authorization: SToken <auth_token>`.

### Cache Bypass

All heartbeats must include proper cache bypass control in the header. Using curl, this is done by adding:

```
-H 'Cache-Control: no-cache'
```

to outbound curl requests along side other Authorization, and Content-Type headers. For implementations other than curl, **set a ‘Cache-Control’ header with a value of ‘no-cache’**.

First Connection: Installed

When the connection is first authenticated, first POST to the /installed/ endpoint with the following parameters:

```
installed:true
type:score_detector ## Use this for all client types
version: x.y.z
```

{% swagger src=".gitbook/assets/swagger-config.json" path="/api/installed/" method="post" %}
[swagger-config.json](.gitbook/assets/swagger-config.json)
{% endswagger %}

Next you begin the `/heartbeat/`, which should include the current game session status. Generally every 10 seconds, with the parameter:

```
session_active=false
```

When the session starts, change that to

```
session_active=true
```

### Code Sample

```
import requests
response = requests.get("https://api.scorbit.io/api/heartbeat/", headers={'Authorization': 'SToken abc123'})
```

### GET https://api.scorbit.io/api/heartbeat/

{% swagger src=".gitbook/assets/swagger-config.json" path="/api/heartbeat/" method="get" %}
[swagger-config.json](.gitbook/assets/swagger-config.json)
{% endswagger %}

Response is in JSON format:

1. Ordinary successful heartbeat confirmation, when a machine is NOT paired to Scorbit, is an empty json:

```
{
}
```

1. Ordinary successful heartbeat confirmation, when a machine has already been successfully paired to Scorbit, includes the machine\_id (this is a unique number for each machine title) as well as the venuemachine\_id (this is a unique identifier for this specific machine on the Scorbit platform):

```
{
    "machine_id": 1000,
    "venuemachine_id": 22222,
}
```

1. Errors will be included in the heartbeat response in a semi-colon delimited list:

```
{
    "errors": "error1;error2;error3",
}
```
